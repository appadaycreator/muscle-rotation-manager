<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SupabaseåŒæœŸãƒ†ã‚¹ãƒˆ - MuscleRotationManager</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-gray-900 mb-8">SupabaseåŒæœŸãƒ†ã‚¹ãƒˆ</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- æ¥ç¶šçŠ¶æ…‹ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-wifi text-blue-500 mr-2"></i>
                        æ¥ç¶šçŠ¶æ…‹
                    </h2>
                    <div id="connection-status" class="space-y-2">
                        <div class="flex items-center">
                            <span class="w-3 h-3 bg-gray-400 rounded-full mr-2"></span>
                            <span>æ¥ç¶šç¢ºèªä¸­...</span>
                        </div>
                    </div>
                </div>

                <!-- èªè¨¼çŠ¶æ…‹ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-user text-green-500 mr-2"></i>
                        èªè¨¼çŠ¶æ…‹
                    </h2>
                    <div id="auth-status" class="space-y-2">
                        <div class="flex items-center">
                            <span class="w-3 h-3 bg-gray-400 rounded-full mr-2"></span>
                            <span>èªè¨¼ç¢ºèªä¸­...</span>
                        </div>
                    </div>
                </div>

                <!-- ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆ -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-save text-purple-500 mr-2"></i>
                        ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆ
                    </h2>
                    <div class="space-y-4">
                        <button id="test-save" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">
                            ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                        </button>
                        <button id="test-load" class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700">
                            ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
                        </button>
                        <div id="save-result" class="text-sm text-gray-600"></div>
                    </div>
                </div>

                <!-- ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç¢ºèª -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-database text-orange-500 mr-2"></i>
                        ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
                    </h2>
                    <div class="space-y-2">
                        <button id="check-local" class="w-full bg-orange-600 text-white py-2 px-4 rounded-md hover:bg-orange-700">
                            ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
                        </button>
                        <button id="clear-local" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">
                            ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                        </button>
                        <div id="local-result" class="text-sm text-gray-600"></div>
                    </div>
                </div>
            </div>

            <!-- ãƒ­ã‚°è¡¨ç¤º -->
            <div class="mt-8 bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-terminal text-gray-500 mr-2"></i>
                    ãƒ­ã‚°
                </h2>
                <div id="log-container" class="bg-gray-900 text-green-400 p-4 rounded-md font-mono text-sm max-h-64 overflow-y-auto">
                    <div>ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„...</div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { supabaseService } from './js/services/supabaseService.js';

        // ãƒ­ã‚°è¡¨ç¤ºé–¢æ•°
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-blue-400';
            logContainer.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // æ¥ç¶šçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
        async function checkConnection() {
            const statusDiv = document.getElementById('connection-status');
            try {
                const isAvailable = supabaseService.isAvailable();
                if (isAvailable) {
                    const isConnected = await supabaseService.checkConnection();
                    if (isConnected) {
                        statusDiv.innerHTML = `
                            <div class="flex items-center">
                                <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                <span>Supabaseæ¥ç¶šæ¸ˆã¿</span>
                            </div>
                        `;
                        log('Supabaseæ¥ç¶šç¢ºèªå®Œäº†', 'success');
                    } else {
                        statusDiv.innerHTML = `
                            <div class="flex items-center">
                                <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                                <span>Supabaseæ¥ç¶šå¤±æ•—</span>
                            </div>
                        `;
                        log('Supabaseæ¥ç¶šå¤±æ•—', 'error');
                    }
                } else {
                    statusDiv.innerHTML = `
                        <div class="flex items-center">
                            <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                            <span>Supabaseåˆ©ç”¨ä¸å¯</span>
                        </div>
                    `;
                    log('Supabaseåˆ©ç”¨ä¸å¯', 'error');
                }
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                        <span>æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}</span>
                    </div>
                `;
                log(`æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
        function checkAuth() {
            const authDiv = document.getElementById('auth-status');
            try {
                const currentUser = supabaseService.getCurrentUser();
                if (currentUser) {
                    authDiv.innerHTML = `
                        <div class="flex items-center">
                            <span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                            <span>èªè¨¼æ¸ˆã¿: ${currentUser.email || 'Unknown'}</span>
                        </div>
                    `;
                    log(`èªè¨¼æ¸ˆã¿: ${currentUser.email || 'Unknown'}`, 'success');
                } else {
                    authDiv.innerHTML = `
                        <div class="flex items-center">
                            <span class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></span>
                            <span>æœªèªè¨¼</span>
                        </div>
                    `;
                    log('æœªèªè¨¼', 'info');
                }
            } catch (error) {
                authDiv.innerHTML = `
                    <div class="flex items-center">
                        <span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                        <span>èªè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}</span>
                    </div>
                `;
                log(`èªè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        async function testSave() {
            const resultDiv = document.getElementById('save-result');
            try {
                const testData = {
                    display_name: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
                    age: 25,
                    weight: 70,
                    height: 175,
                    fitness_level: 'intermediate',
                    primary_goal: 'muscle_gain',
                    workout_frequency: 3,
                    theme_preference: 'auto'
                };

                log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ä¸­...', 'info');
                const result = await supabaseService.saveUserProfile(testData);
                
                if (result) {
                    resultDiv.innerHTML = '<span class="text-green-600">âœ… ä¿å­˜æˆåŠŸï¼ˆSupabaseï¼‰</span>';
                    log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä¿å­˜æˆåŠŸï¼ˆSupabaseï¼‰', 'success');
                } else {
                    resultDiv.innerHTML = '<span class="text-yellow-600">âš ï¸ ä¿å­˜æˆåŠŸï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ï¼‰</span>';
                    log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä¿å­˜æˆåŠŸï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿ï¼‰', 'info');
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="text-red-600">âŒ ä¿å­˜å¤±æ•—: ${error.message}</span>`;
                log(`ä¿å­˜å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        async function testLoad() {
            const resultDiv = document.getElementById('save-result');
            try {
                log('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...', 'info');
                const profile = await supabaseService.getUserProfile();
                
                if (profile && Object.keys(profile).length > 0) {
                    resultDiv.innerHTML = '<span class="text-green-600">âœ… èª­ã¿è¾¼ã¿æˆåŠŸ</span>';
                    log(`ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ: ${JSON.stringify(profile, null, 2)}`, 'success');
                } else {
                    resultDiv.innerHTML = '<span class="text-yellow-600">âš ï¸ ãƒ‡ãƒ¼ã‚¿ãªã—</span>';
                    log('ãƒ‡ãƒ¼ã‚¿ãªã—', 'info');
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="text-red-600">âŒ èª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}</span>`;
                log(`èª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ç¢ºèª
        function checkLocalStorage() {
            const resultDiv = document.getElementById('local-result');
            try {
                const userProfile = localStorage.getItem('userProfile');
                if (userProfile) {
                    const profile = JSON.parse(userProfile);
                    resultDiv.innerHTML = '<span class="text-green-600">âœ… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚ã‚Š</span>';
                    log(`ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿: ${JSON.stringify(profile, null, 2)}`, 'success');
                } else {
                    resultDiv.innerHTML = '<span class="text-yellow-600">âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ãªã—</span>';
                    log('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ãªã—', 'info');
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="text-red-600">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                log(`ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
        function clearLocalStorage() {
            const resultDiv = document.getElementById('local-result');
            try {
                localStorage.removeItem('userProfile');
                resultDiv.innerHTML = '<span class="text-blue-600">ğŸ—‘ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</span>';
                log('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
            } catch (error) {
                resultDiv.innerHTML = `<span class="text-red-600">âŒ ã‚¯ãƒªã‚¢å¤±æ•—: ${error.message}</span>`;
                log(`ã‚¯ãƒªã‚¢å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
        document.getElementById('test-save').addEventListener('click', testSave);
        document.getElementById('test-load').addEventListener('click', testLoad);
        document.getElementById('check-local').addEventListener('click', checkLocalStorage);
        document.getElementById('clear-local').addEventListener('click', clearLocalStorage);

        // åˆæœŸåŒ–
        log('ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’åˆæœŸåŒ–ä¸­...', 'info');
        checkConnection();
        checkAuth();
        checkLocalStorage();
    </script>
</body>
</html>
