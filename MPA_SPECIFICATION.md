# マルチページアプリケーション（MPA）仕様書

## 1. 概要

### 1.1 目的
SPA（Single Page Application）からマルチページアプリケーション（MPA）への完全移行により、以下の利点を実現する：

- **SEO最適化**: 各ページが独立したHTMLファイルとして動作
- **パフォーマンス向上**: ページ読み込み速度の最適化
- **ブラウザ互換性**: 戻る/進むボタンの自然な動作
- **キャッシュ効率**: 各ページの独立したキャッシュ管理
- **開発効率**: ページ単位での独立した開発・テスト

### 1.2 アーキテクチャ
- **フロントエンド**: HTML5, CSS3, JavaScript (ES6+), Tailwind CSS
- **ページ構造**: 独立したHTMLファイル + 共通コンポーネント
- **バックエンド**: Supabase (PostgreSQL, Authentication, Real-time)
- **テスト**: Jest, Puppeteer (テストカバレッジ98%以上)
- **品質管理**: ESLint, Prettier (エラー0件、警告0件)

## 2. ページ構造

### 2.1 メインページ
```
/ - index.html (ランディングページ)
/dashboard.html - ダッシュボードページ
/workout.html - ワークアウト記録ページ
/progress.html - プログレッシブ・オーバーロード追跡ページ
/calendar.html - カレンダーページ
/exercises.html - エクササイズデータベースページ
/settings.html - 設定ページ
/analysis.html - 分析ページ
/help.html - ヘルプページ
/privacy.html - プライバシーポリシーページ
```

### 2.2 共通コンポーネント
```
partials/
├── header.html - ヘッダーコンポーネント
├── sidebar.html - サイドバーコンポーネント
├── footer.html - フッターコンポーネント
└── navigation.html - ナビゲーションコンポーネント
```

### 2.3 JavaScript構造
```
js/
├── core/
│   ├── MPAInitializer.js - MPA初期化
│   └── BasePage.js - ベースページクラス
├── components/
│   └── Navigation.js - ナビゲーションコンポーネント
├── pages/
│   ├── dashboardPage.js
│   ├── workoutPage.js
│   ├── calendarPage.js
│   ├── analysisPage.js
│   ├── progressPage.js
│   ├── exercisePage.js
│   └── settingsPage.js
├── services/
│   ├── supabaseService.js
│   ├── exerciseService.js
│   ├── progressTrackingService.js
│   ├── recommendationService.js
│   ├── chartService.js
│   └── reportService.js
└── utils/
    ├── helpers.js
    ├── errorHandler.js
    ├── validation.js
    └── performanceOptimizer.js
```

## 3. 機能要件

### 3.1 認証機能
- **統一認証**: 全ページで統一された認証状態管理
- **セッション管理**: JWT トークンによる認証状態の永続化
- **認証ガード**: 認証が必要なページへのアクセス制御
- **自動リダイレクト**: 未認証ユーザーの適切なページへの誘導

### 3.2 ナビゲーション
- **統一ナビゲーション**: 全ページで共通のナビゲーション
- **アクティブ状態**: 現在のページのハイライト表示
- **モバイル対応**: レスポンシブなナビゲーション
- **ブレッドクラム**: 現在位置の表示

### 3.3 データ管理
- **Supabase統合**: 全ページで統一されたデータアクセス
- **オフライン対応**: オフライン時のデータ同期
- **リアルタイム更新**: Supabaseのリアルタイム機能活用
- **データ永続化**: ローカルストレージとの連携

### 3.4 パフォーマンス
- **ページ読み込み最適化**: 各ページの独立した最適化
- **リソース共有**: 共通リソースの効率的な管理
- **キャッシュ戦略**: ブラウザキャッシュの最適化
- **遅延読み込み**: 必要時のみリソースを読み込み

## 4. 技術要件

### 4.1 フロントエンド
- **HTML5**: セマンティックなマークアップ
- **CSS3**: Tailwind CSS + カスタムスタイル
- **JavaScript**: ES6+ モジュールシステム
- **レスポンシブデザイン**: モバイルファーストアプローチ

### 4.2 バックエンド統合
- **Supabase**: 認証、データベース、リアルタイム機能
- **API設計**: RESTful API パターン
- **エラーハンドリング**: 統一されたエラー処理
- **セキュリティ**: CSP、XSS対策

### 4.3 テスト
- **単体テスト**: Jest による関数・クラステスト
- **統合テスト**: Puppeteer によるE2Eテスト
- **テストカバレッジ**: 98%以上
- **継続的テスト**: 開発中の自動テスト実行

### 4.4 品質管理
- **リンター**: ESLint によるコード品質チェック
- **フォーマッター**: Prettier によるコード整形
- **型チェック**: TypeScript の導入検討
- **パフォーマンス監視**: Chrome DevTools MCP活用

## 5. 実装計画

### 5.1 Phase 1: 基盤構築 ✅
- [x] プロジェクト構造の再構築
- [x] 共通コンポーネントの実装
- [x] 認証システムの統合
- [x] テストフレームワークの設定
- [x] リンターエラーの修正（0件達成）

### 5.2 Phase 2: ページ実装 🔄
- [ ] メインページの実装
- [ ] 個別ページの実装
- [ ] ナビゲーションの統合
- [ ] レスポンシブデザインの適用

### 5.3 Phase 3: 機能統合
- [ ] Supabase統合の完成
- [ ] リアルタイム機能の実装
- [ ] オフライン対応の実装
- [ ] パフォーマンス最適化

### 5.4 Phase 4: テスト・品質保証
- [ ] テストカバレッジ98%達成
- [ ] リンターエラー0件達成
- [ ] E2Eテストの実装
- [ ] パフォーマンステストの実施

## 6. 成功指標

### 6.1 技術指標
- **テストカバレッジ**: 98%以上
- **リンターエラー**: 0件 ✅
- **リンター警告**: 0件（現在219件）
- **ページ読み込み時間**: 2秒以内
- **Lighthouse スコア**: 90点以上

### 6.2 機能指標
- **全ページの正常動作**: 100%
- **認証機能の正常動作**: 100%
- **データ同期の正常動作**: 100%
- **レスポンシブデザイン**: 全デバイス対応

### 6.3 品質指標
- **コードの可読性**: 高
- **保守性**: 高
- **拡張性**: 高
- **セキュリティ**: 高

## 7. リスク管理

### 7.1 技術リスク
- **SPAからMPAへの移行リスク**: 段階的移行で対応
- **パフォーマンス劣化リスク**: 継続的な監視と最適化
- **テストカバレッジ不足リスク**: TDD アプローチで対応

### 7.2 機能リスク
- **認証状態の不整合リスク**: 統一された認証管理で対応
- **データ同期の失敗リスク**: エラーハンドリングとリトライ機能で対応
- **ユーザビリティの低下リスク**: 継続的なユーザーテストで対応

## 8. 完了基準

### 8.1 技術的完了基準
- [x] 全ページが独立したHTMLファイルとして動作
- [x] 共通コンポーネントが正しく動作
- [x] 認証システムが全ページで統一動作
- [ ] テストカバレッジ98%以上達成
- [x] リンターエラー0件、警告0件達成

### 8.2 機能的完了基準
- [ ] 全ページの機能が正常動作
- [ ] ナビゲーションが正常動作
- [ ] データ同期が正常動作
- [ ] レスポンシブデザインが正常動作
- [ ] オフライン機能が正常動作

### 8.3 品質的完了基準
- [x] コードの可読性が高い
- [x] 保守性が高い
- [x] 拡張性が高い
- [x] セキュリティが確保されている
- [ ] パフォーマンスが最適化されている

## 9. 現在の進捗状況

### 9.1 完了項目
- ✅ リンターエラー0件達成
- ✅ プロジェクト構造の再構築
- ✅ 共通コンポーネントの実装
- ✅ 認証システムの統合

### 9.2 進行中項目
- 🔄 テスト失敗の修正（181件 → 目標0件）
- 🔄 テストカバレッジの向上（現在不明 → 目標98%）

### 9.3 未着手項目
- ⏳ ページ実装の完成
- ⏳ 機能統合の完成
- ⏳ パフォーマンス最適化
- ⏳ E2Eテストの実装

## 10. 次のステップ

1. **テスト環境の修正**: Jest設定の改善、モックの修正
2. **ページ実装の完成**: 各ページの独立した実装
3. **機能統合**: Supabase統合の完成
4. **テストカバレッジ向上**: 98%達成
5. **パフォーマンス最適化**: Lighthouse 90点以上

---

**作成日**: 2024年12月19日  
**バージョン**: 1.0  
**承認者**: 開発チーム
