<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç­‹ãƒˆãƒ¬éƒ¨ä½ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"
    />
    <style>
      .test-pass {
        @apply bg-green-100 border-green-500 text-green-800;
      }
      .test-fail {
        @apply bg-red-100 border-red-500 text-red-800;
      }
      .test-pending {
        @apply bg-yellow-100 border-yellow-500 text-yellow-800;
      }
      .test-running {
        @apply bg-blue-100 border-blue-500 text-blue-800;
      }
      .console-output {
        background: #1a1a1a;
        color: #00ff00;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        line-height: 1.4;
      }
      .test-category {
        transition: all 0.3s ease;
      }
      .test-category:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="bg-white shadow-sm border-b">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center space-x-3">
            <i class="fas fa-dumbbell text-3xl text-blue-600"></i>
            <div>
              <h1 class="text-2xl font-bold text-gray-900">
                ç­‹ãƒˆãƒ¬éƒ¨ä½ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
              </h1>
              <p class="text-sm text-gray-600">
                ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º - ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼
              </p>
            </div>
          </div>
          <div class="flex items-center space-x-4">
            <button
              id="runAllTests"
              class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
            >
              <i class="fas fa-play mr-2"></i>å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            </button>
            <button
              id="runUnitTests"
              class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"
            >
              <i class="fas fa-cog mr-2"></i>ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
            </button>
            <button
              id="runIntegrationTests"
              class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
            >
              <i class="fas fa-link mr-2"></i>çµ±åˆãƒ†ã‚¹ãƒˆ
            </button>
            <button
              id="runSpecTests"
              class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors"
            >
              <i class="fas fa-book mr-2"></i>ä»•æ§˜æ›¸ãƒ†ã‚¹ãƒˆ
            </button>
            <button
              id="clearResults"
              class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors"
            >
              <i class="fas fa-trash mr-2"></i>ã‚¯ãƒªã‚¢
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- ãƒ†ã‚¹ãƒˆæ¦‚è¦ -->
      <div class="bg-white rounded-lg shadow-sm mb-8 p-6">
        <h2 class="text-xl font-bold text-gray-900 mb-4">
          <i class="fas fa-chart-line mr-2"></i>ãƒ†ã‚¹ãƒˆå®Ÿè¡ŒçŠ¶æ³
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
          <div class="bg-blue-50 p-4 rounded-lg">
            <div class="flex items-center">
              <i class="fas fa-list-check text-blue-600 text-xl mr-3"></i>
              <div>
                <p class="text-sm text-gray-600">ç·ãƒ†ã‚¹ãƒˆæ•°</p>
                <p class="text-2xl font-bold text-blue-600" id="totalTests">
                  0
                </p>
              </div>
            </div>
          </div>
          <div class="bg-green-50 p-4 rounded-lg">
            <div class="flex items-center">
              <i class="fas fa-check-circle text-green-600 text-xl mr-3"></i>
              <div>
                <p class="text-sm text-gray-600">æˆåŠŸ</p>
                <p class="text-2xl font-bold text-green-600" id="passedTests">
                  0
                </p>
              </div>
            </div>
          </div>
          <div class="bg-red-50 p-4 rounded-lg">
            <div class="flex items-center">
              <i class="fas fa-times-circle text-red-600 text-xl mr-3"></i>
              <div>
                <p class="text-sm text-gray-600">å¤±æ•—</p>
                <p class="text-2xl font-bold text-red-600" id="failedTests">
                  0
                </p>
              </div>
            </div>
          </div>
          <div class="bg-yellow-50 p-4 rounded-lg">
            <div class="flex items-center">
              <i class="fas fa-clock text-yellow-600 text-xl mr-3"></i>
              <div>
                <p class="text-sm text-gray-600">ä¿ç•™</p>
                <p class="text-2xl font-bold text-yellow-600" id="pendingTests">
                  0
                </p>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 p-4 rounded-lg">
            <div class="flex items-center">
              <i class="fas fa-stopwatch text-gray-600 text-xl mr-3"></i>
              <div>
                <p class="text-sm text-gray-600">å®Ÿè¡Œæ™‚é–“</p>
                <p class="text-2xl font-bold text-gray-600" id="executionTime">
                  0ms
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
        <!-- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-category bg-white rounded-lg shadow-sm p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">
            <i class="fas fa-cog text-green-600 mr-2"></i>ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
          </h3>
          <p class="text-sm text-gray-600 mb-4">å€‹åˆ¥æ©Ÿèƒ½ã®å˜ä½“ãƒ†ã‚¹ãƒˆ</p>
          <div class="space-y-2" id="unitTestResults">
            <div class="text-sm text-gray-500">ãƒ†ã‚¹ãƒˆæœªå®Ÿè¡Œ</div>
          </div>
        </div>

        <!-- çµ±åˆãƒ†ã‚¹ãƒˆ -->
        <div class="test-category bg-white rounded-lg shadow-sm p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">
            <i class="fas fa-link text-purple-600 mr-2"></i>çµ±åˆãƒ†ã‚¹ãƒˆ
          </h3>
          <p class="text-sm text-gray-600 mb-4">æ©Ÿèƒ½é–“ã®é€£æºãƒ†ã‚¹ãƒˆ</p>
          <div class="space-y-2" id="integrationTestResults">
            <div class="text-sm text-gray-500">ãƒ†ã‚¹ãƒˆæœªå®Ÿè¡Œ</div>
          </div>
        </div>

        <!-- ä»•æ§˜æ›¸é§†å‹•ãƒ†ã‚¹ãƒˆ -->
        <div class="test-category bg-white rounded-lg shadow-sm p-6">
          <h3 class="text-lg font-bold text-gray-900 mb-4">
            <i class="fas fa-book text-orange-600 mr-2"></i>ä»•æ§˜æ›¸é§†å‹•ãƒ†ã‚¹ãƒˆ
          </h3>
          <p class="text-sm text-gray-600 mb-4">SPEC.mdæº–æ‹ ãƒ†ã‚¹ãƒˆ</p>
          <div class="space-y-2" id="specTestResults">
            <div class="text-sm text-gray-500">ãƒ†ã‚¹ãƒˆæœªå®Ÿè¡Œ</div>
          </div>
        </div>
      </div>

      <!-- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ› -->
      <div class="bg-white rounded-lg shadow-sm p-6">
        <h3 class="text-lg font-bold text-gray-900 mb-4">
          <i class="fas fa-terminal mr-2"></i>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ­ã‚°
        </h3>
        <div
          class="console-output p-4 rounded-lg h-96 overflow-y-auto"
          id="consoleOutput"
        >
          <div class="text-green-400"># ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºç’°å¢ƒãŒæº–å‚™ã•ã‚Œã¾ã—ãŸ</div>
          <div class="text-green-400">
            # ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ä¸Šéƒ¨ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„
          </div>
        </div>
      </div>
    </main>

    <!-- ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ -->
    <script src="unit/test-runner.js"></script>
    <script src="mocks/supabase.mock.js"></script>

    <script>
      // ãƒ†ã‚¹ãƒˆç®¡ç†ã‚¯ãƒ©ã‚¹
      class TestManager {
        constructor() {
          this.results = {
            unit: [],
            integration: [],
            spec: [],
          };
          this.isRunning = false;
        }

        async loadAndRunTests(category) {
          if (this.isRunning) return;
          this.isRunning = true;

          try {
            this.log(`ğŸš€ ${category}ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™...`);

            // ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
            testRunner.reset();

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
            await this.loadTestFiles(category);

            // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            const results = await testRunner.run();
            this.results[category] = results;

            // çµæœã‚’è¡¨ç¤º
            this.displayResults(category, results);
            this.updateStats();

            this.log(`âœ… ${category}ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ`);
          } catch (error) {
            this.log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
          } finally {
            this.isRunning = false;
          }
        }

        async loadTestFiles(category) {
          const testFiles = {
            unit: [
              'unit/muscle-groups.test.js',
              'unit/validation.test.js',
              'unit/error-handler.test.js',
              'unit/workout-recording.test.js',
              'unit/workout-save.test.js',
              'unit/page-modules.test.js',
              'unit/recommendation-algorithm.test.js',
              'unit/exercise-service.test.js',
              'unit/calendar-functionality.test.js',
              'unit/progress-tracking.test.js',
              'unit/supabase-connection.test.js',
            ],
            integration: [
              'integration/error-handling-integration.test.js',
              'integration/validation-integration.test.js',
              'integration/workout-flow.test.js',
              'integration/workout-save-integration.test.js',
              'integration/recommendation-integration.test.js',
              'integration/exercise-management-integration.test.js',
              'integration/calendar-integration.test.js',
              'integration/progress-integration.test.js',
              'integration/supabase-integration.test.js',
            ],
            spec: ['spec-driven/requirements.test.js'],
          };

          const files =
            category === 'all'
              ? [...testFiles.unit, ...testFiles.integration, ...testFiles.spec]
              : testFiles[category] || [];

          for (const file of files) {
            try {
              await this.loadScript(file);
              this.log(`ğŸ“ ${file} ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
            } catch (error) {
              this.log(
                `âŒ ${file} ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${error.message}`,
                'error'
              );
            }
          }
        }

        loadScript(src) {
          return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = src;
            script.onload = resolve;
            script.onerror = () => reject(new Error(`Failed to load ${src}`));
            document.head.appendChild(script);
          });
        }

        displayResults(category, results) {
          const container = document.getElementById(`${category}TestResults`);
          if (!container) return;

          container.innerHTML = '';

          if (results.errors && results.errors.length > 0) {
            results.errors.forEach((error) => {
              const errorDiv = document.createElement('div');
              errorDiv.className = 'test-fail p-2 rounded text-xs';
              errorDiv.innerHTML = `âŒ ${error.test}: ${error.error}`;
              container.appendChild(errorDiv);
            });
          }

          // æˆåŠŸã—ãŸãƒ†ã‚¹ãƒˆã®è¡¨ç¤º
          const passedCount = results.passed || 0;
          const totalCount = results.total || 0;

          const summaryDiv = document.createElement('div');
          summaryDiv.className =
            passedCount === totalCount
              ? 'test-pass p-2 rounded text-xs'
              : 'test-fail p-2 rounded text-xs';
          summaryDiv.innerHTML = `${passedCount}/${totalCount} ãƒ†ã‚¹ãƒˆæˆåŠŸ`;
          container.appendChild(summaryDiv);
        }

        updateStats() {
          const allResults = [
            ...this.results.unit,
            ...this.results.integration,
            ...this.results.spec,
          ];
          const totalPassed = allResults.reduce(
            (sum, result) => sum + (result.passed || 0),
            0
          );
          const totalFailed = allResults.reduce(
            (sum, result) => sum + (result.failed || 0),
            0
          );
          const totalTests = totalPassed + totalFailed;

          document.getElementById('totalTests').textContent = totalTests;
          document.getElementById('passedTests').textContent = totalPassed;
          document.getElementById('failedTests').textContent = totalFailed;
          document.getElementById('pendingTests').textContent = 0;
        }

        log(message, type = 'info') {
          const console = document.getElementById('consoleOutput');
          const timestamp = new Date().toLocaleTimeString();
          const logEntry = document.createElement('div');

          const colors = {
            info: 'text-green-400',
            error: 'text-red-400',
            warning: 'text-yellow-400',
          };

          logEntry.className = colors[type] || colors.info;
          logEntry.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> ${message}`;
          console.appendChild(logEntry);
          console.scrollTop = console.scrollHeight;
        }

        clear() {
          document.getElementById('consoleOutput').innerHTML =
            '<div class="text-green-400"># ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ</div>';

          // çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
          this.results = { unit: [], integration: [], spec: [] };

          // çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆ
          document.getElementById('totalTests').textContent = '0';
          document.getElementById('passedTests').textContent = '0';
          document.getElementById('failedTests').textContent = '0';
          document.getElementById('pendingTests').textContent = '0';
          document.getElementById('executionTime').textContent = '0ms';

          // å„ã‚«ãƒ†ã‚´ãƒªã®çµæœã‚’ã‚¯ãƒªã‚¢
          ['unit', 'integration', 'spec'].forEach((category) => {
            const container = document.getElementById(`${category}TestResults`);
            if (container) {
              container.innerHTML =
                '<div class="text-sm text-gray-500">ãƒ†ã‚¹ãƒˆæœªå®Ÿè¡Œ</div>';
            }
          });
        }
      }

      // ãƒ†ã‚¹ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
      const testManager = new TestManager();

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
      document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('runAllTests').addEventListener('click', () => {
          testManager.loadAndRunTests('all');
        });

        document
          .getElementById('runUnitTests')
          .addEventListener('click', () => {
            testManager.loadAndRunTests('unit');
          });

        document
          .getElementById('runIntegrationTests')
          .addEventListener('click', () => {
            testManager.loadAndRunTests('integration');
          });

        document
          .getElementById('runSpecTests')
          .addEventListener('click', () => {
            testManager.loadAndRunTests('spec');
          });

        document
          .getElementById('clearResults')
          .addEventListener('click', () => {
            testManager.clear();
          });

        // åˆæœŸåŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        testManager.log('ğŸ¯ ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºç’°å¢ƒãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ');
        testManager.log('ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª:');
        testManager.log('   â€¢ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: å€‹åˆ¥æ©Ÿèƒ½ã®å˜ä½“ãƒ†ã‚¹ãƒˆ');
        testManager.log('   â€¢ çµ±åˆãƒ†ã‚¹ãƒˆ: æ©Ÿèƒ½é–“ã®é€£æºãƒ†ã‚¹ãƒˆ');
        testManager.log('   â€¢ ä»•æ§˜æ›¸é§†å‹•ãƒ†ã‚¹ãƒˆ: SPEC.mdæº–æ‹ ãƒ†ã‚¹ãƒˆ');
      });

      // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
      window.testManager = testManager;
    </script>
  </body>
</html>
